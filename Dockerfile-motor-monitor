FROM rustlang/rust:nightly as builder

WORKDIR /usr/src/data_transfer_objects
COPY data_transfer_objects .

WORKDIR /usr/src/utils
COPY utils .

WORKDIR /usr/src/motor_driver
COPY ./motor_driver .
RUN cargo install --path .

WORKDIR /usr/src/motor_monitor_cs
COPY ./motor_monitor_cs .
RUN cargo install --path .

WORKDIR /usr/src/motor_monitor_rx
COPY ./motor_monitor_rx .
RUN cargo install --path .

FROM debian:buster-slim
COPY motor_driver/resources/config-production.toml /etc/config-production.toml
COPY --from=builder /usr/local/cargo/bin/motor_driver /usr/local/bin/motor_driver
COPY --from=builder /usr/local/cargo/bin/motor_monitor_cs /usr/local/bin/motor_monitor_cs
COPY --from=builder /usr/local/cargo/bin/motor_monitor_rx /usr/local/bin/motor_monitor_rx
ENV RUST_LOG=info
CMD ["motor_driver"]